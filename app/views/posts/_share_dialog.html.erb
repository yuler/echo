<%# Share Dialog %>
<dialog data-share-target="dialog" class="backdrop:backdrop-blur-sm backdrop:bg-black/40 rounded-2xl shadow-2xl p-0 w-[calc(100%-2rem)] sm:w-full sm:max-w-md m-auto bg-white overflow-hidden" aria-modal="true">
  <div class="p-5 relative">
    <button type="button" data-action="click->share#close" class="absolute top-4 right-4 z-10 text-neutral-400 hover:text-neutral-600 focus-ring p-1.5 rounded-full bg-white/80 backdrop-blur-sm shadow-sm border border-neutral-100">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <div class="mb-5 bg-neutral-100 rounded-xl overflow-hidden relative shadow-inner flex items-center justify-center min-h-[150px]">
      <img data-share-target="preview" class="w-full h-auto object-contain" />
      <div data-share-target="loading" class="absolute inset-0 flex items-center justify-center bg-neutral-100/80">
        <div class="w-8 h-8 border-4 border-neutral-300 border-t-neutral-800 rounded-full animate-spin"></div>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-3">
      <button type="button" data-action="click->share#download" class="flex items-center justify-center gap-2 py-2.5 px-4 bg-neutral-900 text-white rounded-xl text-body-sm font-medium hover:bg-neutral-800 transition-colors focus-ring shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
        Download
      </button>
      <button type="button" data-action="click->share#copyLink" class="flex items-center justify-center gap-2 py-2.5 px-4 bg-white border border-neutral-200 text-neutral-800 rounded-xl text-body-sm font-medium hover:bg-neutral-50 transition-colors focus-ring shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
        Copy Link
      </button>
    </div>
    <%# Web share API fallback %>
    <div class="mt-3 hidden" data-share-target="webShareContainer">
      <button type="button" data-action="click->share#webShare" class="w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-neutral-100 text-neutral-800 rounded-xl text-body-sm font-medium hover:bg-neutral-200 transition-colors focus-ring">
        Share via Device
      </button>
    </div>
  </div>
</dialog>

<%# Share Poster Template (Hidden) %>
<div class="absolute overflow-hidden pointer-events-none z-[-1]" style="top: 0; left: 0; width: 0; height: 0;">
  <div data-share-target="posterTemplate" class="bg-white text-neutral-900" style="width: 1080px; font-family: ui-sans-serif, system-ui, sans-serif;">
    <div class="p-[80px] border-[12px] border-neutral-100 h-full w-full flex flex-col box-border">
      <%# Header / Logo %>
      <div class="flex items-center justify-between mb-[80px]">
        <div class="flex items-center gap-[16px]">
          <img src="/icon.png" class="w-[64px] h-[64px] object-contain" />
          <span class="text-[42px] font-bold tracking-tight">ECHO</span>
        </div>
        <div class="text-[36px] text-neutral-500"><%= post.created_at.strftime("%b %d, %Y") %></div>
      </div>

      <%# Poster %>
      <% if post.poster_url.present? %>
        <div class="mb-[80px] w-[920px] rounded-[30px] overflow-hidden relative border-2 border-black/5 bg-neutral-100 flex-shrink-0">
          <img src="<%= post.poster_url %>" class="w-full h-auto object-cover" crossorigin="anonymous" />
        </div>
      <% end %>

      <%# Title %>
      <h1 class="text-[64px] font-bold leading-[1.3] mb-[40px] whitespace-pre-wrap"><%= post.title_en.presence || post.title %></h1>

      <%# Guide %>
      <% if post.guide.present? %>
        <p class="text-[36px] text-neutral-600 leading-[1.4] mb-[40px] whitespace-pre-wrap"><%= post.guide %></p>
      <% end %>

      <div class="h-[60px] w-full flex-grow"></div>

      <%# Divider %>
      <div class="w-full h-[2px] bg-neutral-200 mt-[20px] mb-[60px]"></div>

      <%# QR Code Area %>
      <div class="flex items-center gap-[40px]">
        <img data-share-target="qrCodeImg" class="w-[260px] h-[260px] object-contain" />
        <span class="text-[42px] font-medium text-neutral-700">Scan QR code to read</span>
      </div>
    </div>
  </div>
</div>
