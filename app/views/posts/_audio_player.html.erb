<%# Floating audio player widget â€” rendered at the bottom of show page %>
<div class="audio-player-widget" data-audio-player-target="header">
  <div class="audio-player-inner">
    <%# Waveform progress bar %>
    <div class="audio-player-progress-section">
      <% wave_heights = 80.times.map { 25 + rand(50) } %>
      <div class="audio-player-waveform" data-audio-player-target="progressBar" data-action="click->audio-player#scrub">
        <%# Waveform background %>
        <div class="audio-player-waveform-bg">
          <% wave_heights.each do |height| %>
            <div class="audio-player-wave-bar" style="height: <%= height %>%"></div>
          <% end %>
        </div>
        <%# Progress overlay %>
        <div class="audio-player-waveform-fill" data-audio-player-target="progress" style="width: 0%">
          <div class="audio-player-waveform-fill-inner" data-audio-player-target="progressInner">
            <% wave_heights.each do |height| %>
              <div class="audio-player-wave-bar-active" style="height: <%= height %>%; min-width: 0"></div>
            <% end %>
          </div>
        </div>
      </div>
      <div class="audio-player-timestamps">
        <span data-audio-player-target="currentTime">0:00</span>
        <span data-audio-player-target="totalTime"><%= post.formatted_duration %></span>
      </div>
    </div>

    <%# Playback controls %>
    <div class="audio-player-controls">
      <%# Action buttons (left align) %>
      <div class="audio-player-actions-left">
        <%# Bilingual toggle %>
        <button class="audio-player-icon-btn" data-action="click->audio-player#toggleTranslation" data-audio-player-target="translationBtn" title="Toggle Chinese translation" aria-label="Toggle translation">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/>
            <path d="m22 22-5-10-5 10"/><path d="M14 18h6"/>
          </svg>
        </button>
      </div>

      <%# Main transport group (centered) %>
      <div class="audio-player-transport">
        <%# 15s rewind %>
        <button class="audio-player-skip-btn" data-action="click->audio-player#rewind" aria-label="Rewind 15 seconds">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
            <text x="12" y="16.5" text-anchor="middle" font-size="8" font-weight="700" font-family="sans-serif" fill="currentColor">15</text>
          </svg>
        </button>

        <%# Play / Pause %>
        <button class="audio-player-play-btn" data-action="click->audio-player#togglePlay" aria-label="Play or pause">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" data-audio-player-target="playIcon">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" class="hidden" viewBox="0 0 24 24" fill="currentColor" data-audio-player-target="pauseIcon">
            <path d="M6 4h4v16H6zm8 0h4v16h-4z"/>
          </svg>
        </button>

        <%# 15s forward %>
        <button class="audio-player-skip-btn" data-action="click->audio-player#forward" aria-label="Forward 15 seconds">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18 13c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6v4l5-5-5-5v4c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8h-2z"/>
            <text x="12" y="16.5" text-anchor="middle" font-size="8" font-weight="700" font-family="sans-serif" fill="currentColor">15</text>
          </svg>
        </button>
      </div>

      <%# Right action buttons %>
      <div class="audio-player-actions-right">
        <%# Speed control %>
        <div class="audio-player-speed-group">
          <button class="audio-player-speed-btn"
                  data-action="click->audio-player#setSpeed"
                  data-audio-player-target="speedBtn"
                  data-speed="0.75">
            Slow
          </button>
          <button class="audio-player-speed-btn active"
                  data-action="click->audio-player#setSpeed"
                  data-audio-player-target="speedBtn"
                  data-speed="1">
            Normal
          </button>
          <button class="audio-player-speed-btn"
                  data-action="click->audio-player#setSpeed"
                  data-audio-player-target="speedBtn"
                  data-speed="1.25">
            Quick
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


